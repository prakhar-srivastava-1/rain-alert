import requests
from secrets import API_KEY


class WeatherData:

    def __init__(self):
        self.owm_endpoint = "https://api.openweathermap.org/data/2.5/onecall"
        self.parameters = {
            # Prayagraj
            # 'lat': '22.17',
            # 'lon': '76.06',
            # Osaka
            'lat': 34.69,
            'lon': 135.50,
            'appid': API_KEY,
            'exclude': 'current,minutely,daily',
        }
        self.weather_data = self.grab_codes()

    def get_response(self):
        response = requests.get(self.owm_endpoint, params=self.parameters)
        response.raise_for_status()
        weather_data = response.json()["hourly"]
        # print(weather_data["hourly"])
        # weather_data = [{'dt': 1628870400, 'temp': 299.55, 'feels_like': 299.55, 'pressure': 1005, 'humidity': 66, 'dew_point': 292.69, 'uvi': 0, 'clouds': 76, 'visibility': 10000, 'wind_speed': 3.7, 'wind_deg': 283, 'wind_gust': 8.49,
        #                  'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0.38},
        #                 {'dt': 1628874000, 'temp': 299.84, 'feels_like': 301.29, 'pressure': 1005, 'humidity': 67, 'dew_point': 293.21, 'uvi': 0, 'clouds': 75, 'visibility': 10000, 'wind_speed': 3.48, 'wind_deg': 272, 'wind_gust': 8.32, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0.34}, {'dt': 1628877600, 'temp': 299.89, 'feels_like': 301.44, 'pressure': 1005, 'humidity': 68, 'dew_point': 293.49, 'uvi': 0, 'clouds': 71, 'visibility': 10000, 'wind_speed': 3.7, 'wind_deg': 265, 'wind_gust': 7.94, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0.26}, {'dt': 1628881200, 'temp': 299.78, 'feels_like': 299.78, 'pressure': 1005, 'humidity': 71, 'dew_point': 294.09, 'uvi': 0, 'clouds': 56, 'visibility': 10000, 'wind_speed': 3.95, 'wind_deg': 258, 'wind_gust': 7.53, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0.03}, {'dt': 1628884800, 'temp': 299.38, 'feels_like': 299.38, 'pressure': 1004, 'humidity': 74, 'dew_point': 294.38, 'uvi': 0, 'clouds': 72, 'visibility': 10000, 'wind_speed': 4.21, 'wind_deg': 253, 'wind_gust': 7.83, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0.03}, {'dt': 1628888400, 'temp': 298.87, 'feels_like': 299.53, 'pressure': 1004, 'humidity': 78, 'dew_point': 294.58, 'uvi': 0, 'clouds': 81, 'visibility': 10000, 'wind_speed': 4.41, 'wind_deg': 249, 'wind_gust': 8.15, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0.03}, {'dt': 1628892000, 'temp': 298.49, 'feels_like': 299.17, 'pressure': 1003, 'humidity': 80, 'dew_point': 294.56, 'uvi': 0, 'clouds': 85, 'visibility': 10000, 'wind_speed': 4.48, 'wind_deg': 248, 'wind_gust': 8.11, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1628895600, 'temp': 298.19, 'feels_like': 298.86, 'pressure': 1003, 'humidity': 81, 'dew_point': 294.47, 'uvi': 0, 'clouds': 86, 'visibility': 10000, 'wind_speed': 4.58, 'wind_deg': 248, 'wind_gust': 8.27, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1628899200, 'temp': 297.92, 'feels_like': 298.59, 'pressure': 1004, 'humidity': 82, 'dew_point': 294.42, 'uvi': 0, 'clouds': 84, 'visibility': 10000, 'wind_speed': 4.52, 'wind_deg': 248, 'wind_gust': 8.19, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1628902800, 'temp': 297.85, 'feels_like': 298.54, 'pressure': 1004, 'humidity': 83, 'dew_point': 294.5, 'uvi': 0.14, 'clouds': 94, 'visibility': 10000, 'wind_speed': 4.28, 'wind_deg': 252, 'wind_gust': 7.94, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1628906400, 'temp': 298.97, 'feels_like': 299.67, 'pressure': 1005, 'humidity': 79, 'dew_point': 294.81, 'uvi': 0.94, 'clouds': 68, 'visibility': 10000, 'wind_speed': 5.04, 'wind_deg': 255, 'wind_gust': 7.86, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1628910000, 'temp': 300.8, 'feels_like': 303.27, 'pressure': 1005, 'humidity': 71, 'dew_point': 294.97, 'uvi': 2.92, 'clouds': 47, 'visibility': 10000, 'wind_speed': 5.47, 'wind_deg': 259, 'wind_gust': 7.68, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}], 'pop': 0}, {'dt': 1628913600, 'temp': 302.46, 'feels_like': 305.42, 'pressure': 1005, 'humidity': 64, 'dew_point': 294.84, 'uvi': 5.86, 'clouds': 36, 'visibility': 10000, 'wind_speed': 5.85, 'wind_deg': 260, 'wind_gust': 7.11, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}], 'pop': 0}, {'dt': 1628917200, 'temp': 303.91, 'feels_like': 307.03, 'pressure': 1005, 'humidity': 58, 'dew_point': 294.68, 'uvi': 9.11, 'clouds': 35, 'visibility': 10000, 'wind_speed': 5.95, 'wind_deg': 261, 'wind_gust': 6.7, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}], 'pop': 0}, {'dt': 1628920800, 'temp': 304.89, 'feels_like': 308, 'pressure': 1004, 'humidity': 54, 'dew_point': 294.23, 'uvi': 11.57, 'clouds': 39, 'visibility': 10000, 'wind_speed': 5.83, 'wind_deg': 261, 'wind_gust': 6.35, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}], 'pop': 0}, {'dt': 1628924400, 'temp': 305.2, 'feels_like': 307.85, 'pressure': 1004, 'humidity': 51, 'dew_point': 293.71, 'uvi': 8.08, 'clouds': 83, 'visibility': 10000, 'wind_speed': 5.77, 'wind_deg': 263, 'wind_gust': 6.34, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0.18}, {'dt': 1628928000, 'temp': 304.59, 'feels_like': 306.96, 'pressure': 1003, 'humidity': 52, 'dew_point': 293.4, 'uvi': 7.37, 'clouds': 91, 'visibility': 10000, 'wind_speed': 5.28, 'wind_deg': 270, 'wind_gust': 6.06, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.08}, {'dt': 1628931600, 'temp': 304.41, 'feels_like': 306.63, 'pressure': 1002, 'humidity': 52, 'dew_point': 293.46, 'uvi': 5.67, 'clouds': 94, 'visibility': 10000, 'wind_speed': 5.33, 'wind_deg': 276, 'wind_gust': 6.3, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.07}, {'dt': 1628935200, 'temp': 303.65, 'feels_like': 306.1, 'pressure': 1002, 'humidity': 56, 'dew_point': 293.87, 'uvi': 3.27, 'clouds': 95, 'visibility': 10000, 'wind_speed': 4.96, 'wind_deg': 274, 'wind_gust': 6.46, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.03}, {'dt': 1628938800, 'temp': 303.36, 'feels_like': 305.78, 'pressure': 1002, 'humidity': 57, 'dew_point': 293.88, 'uvi': 1.54, 'clouds': 96, 'visibility': 10000, 'wind_speed': 4.34, 'wind_deg': 266, 'wind_gust': 6.48, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.02}, {'dt': 1628942400, 'temp': 303.06, 'feels_like': 305.62, 'pressure': 1002, 'humidity': 59, 'dew_point': 293.96, 'uvi': 0.46, 'clouds': 97, 'visibility': 10000, 'wind_speed': 4.19, 'wind_deg': 253, 'wind_gust': 6.91, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.02}, {'dt': 1628946000, 'temp': 302.16, 'feels_like': 304.51, 'pressure': 1002, 'humidity': 62, 'dew_point': 294.12, 'uvi': 0, 'clouds': 92, 'visibility': 10000, 'wind_speed': 3.65, 'wind_deg': 244, 'wind_gust': 6.78, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.14}, {'dt': 1628949600, 'temp': 301.52, 'feels_like': 303.69, 'pressure': 1003, 'humidity': 64, 'dew_point': 293.93, 'uvi': 0, 'clouds': 82, 'visibility': 10000, 'wind_speed': 3.36, 'wind_deg': 256, 'wind_gust': 6.68, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0.13}, {'dt': 1628953200, 'temp': 301.13, 'feels_like': 303.27, 'pressure': 1004, 'humidity': 66, 'dew_point': 293.95, 'uvi': 0, 'clouds': 76, 'visibility': 10000, 'wind_speed': 2.7, 'wind_deg': 259, 'wind_gust': 5.51, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0.07}, {'dt': 1628956800, 'temp': 300.87, 'feels_like': 302.94, 'pressure': 1004, 'humidity': 67, 'dew_point': 294, 'uvi': 0, 'clouds': 77, 'visibility': 10000, 'wind_speed': 3.07, 'wind_deg': 251, 'wind_gust': 6.11, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1628960400, 'temp': 300.51, 'feels_like': 302.43, 'pressure': 1004, 'humidity': 68, 'dew_point': 294.04, 'uvi': 0, 'clouds': 79, 'visibility': 10000, 'wind_speed': 3.97, 'wind_deg': 250, 'wind_gust': 7.27, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1628964000, 'temp': 300.02, 'feels_like': 301.87, 'pressure': 1005, 'humidity': 71, 'dew_point': 294.1, 'uvi': 0, 'clouds': 78, 'visibility': 10000, 'wind_speed': 4.88, 'wind_deg': 248, 'wind_gust': 8.89, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1628967600, 'temp': 299.13, 'feels_like': 299.13, 'pressure': 1004, 'humidity': 74, 'dew_point': 293.97, 'uvi': 0, 'clouds': 60, 'visibility': 10000, 'wind_speed': 5.13, 'wind_deg': 244, 'wind_gust': 9.51, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0}, {'dt': 1628971200, 'temp': 298.37, 'feels_like': 298.93, 'pressure': 1004, 'humidity': 76, 'dew_point': 293.75, 'uvi': 0, 'clouds': 48, 'visibility': 10000, 'wind_speed': 4.9, 'wind_deg': 246, 'wind_gust': 9.46, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03n'}], 'pop': 0}, {'dt': 1628974800, 'temp': 297.88, 'feels_like': 298.45, 'pressure': 1004, 'humidity': 78, 'dew_point': 293.62, 'uvi': 0, 'clouds': 43, 'visibility': 10000, 'wind_speed': 4.59, 'wind_deg': 246, 'wind_gust': 9.28, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03n'}], 'pop': 0}, {'dt': 1628978400, 'temp': 297.6, 'feels_like': 298.16, 'pressure': 1004, 'humidity': 79, 'dew_point': 293.65, 'uvi': 0, 'clouds': 37, 'visibility': 10000, 'wind_speed': 4.24, 'wind_deg': 249, 'wind_gust': 9.3, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03n'}], 'pop': 0}, {'dt': 1628982000, 'temp': 297.38, 'feels_like': 297.97, 'pressure': 1004, 'humidity': 81, 'dew_point': 293.69, 'uvi': 0, 'clouds': 39, 'visibility': 10000, 'wind_speed': 3.94, 'wind_deg': 249, 'wind_gust': 8.76, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03n'}], 'pop': 0}, {'dt': 1628985600, 'temp': 297.21, 'feels_like': 297.84, 'pressure': 1004, 'humidity': 83, 'dew_point': 293.83, 'uvi': 0, 'clouds': 44, 'visibility': 10000, 'wind_speed': 3.82, 'wind_deg': 249, 'wind_gust': 8.11, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03n'}], 'pop': 0}, {'dt': 1628989200, 'temp': 297.3, 'feels_like': 297.94, 'pressure': 1005, 'humidity': 83, 'dew_point': 294.17, 'uvi': 0.05, 'clouds': 48, 'visibility': 10000, 'wind_speed': 3.43, 'wind_deg': 246, 'wind_gust': 7.03, 'weather': [{'id': 802, 'main': 'Clouds', 'description': 'scattered clouds', 'icon': '03d'}], 'pop': 0.04}, {'dt': 1628992800, 'temp': 298.62, 'feels_like': 299.26, 'pressure': 1005, 'humidity': 78, 'dew_point': 294.4, 'uvi': 0.35, 'clouds': 53, 'visibility': 10000, 'wind_speed': 4.14, 'wind_deg': 255, 'wind_gust': 6.21, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1628996400, 'temp': 300.03, 'feels_like': 302.04, 'pressure': 1006, 'humidity': 73, 'dew_point': 294.52, 'uvi': 1.1, 'clouds': 58, 'visibility': 10000, 'wind_speed': 4.22, 'wind_deg': 261, 'wind_gust': 6.53, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1629000000, 'temp': 301.1, 'feels_like': 303.46, 'pressure': 1006, 'humidity': 68, 'dew_point': 294.48, 'uvi': 4.25, 'clouds': 64, 'visibility': 10000, 'wind_speed': 4.87, 'wind_deg': 261, 'wind_gust': 6.55, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1629003600, 'temp': 302.37, 'feels_like': 304.89, 'pressure': 1006, 'humidity': 62, 'dew_point': 294.32, 'uvi': 6.61, 'clouds': 71, 'visibility': 10000, 'wind_speed': 4.73, 'wind_deg': 263, 'wind_gust': 5.52, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1629007200, 'temp': 303.98, 'feels_like': 306.72, 'pressure': 1006, 'humidity': 56, 'dew_point': 294.15, 'uvi': 8.4, 'clouds': 75, 'visibility': 10000, 'wind_speed': 4.56, 'wind_deg': 262, 'wind_gust': 5.01, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0}, {'dt': 1629010800, 'temp': 305.26, 'feels_like': 307.96, 'pressure': 1005, 'humidity': 51, 'dew_point': 293.71, 'uvi': 9.59, 'clouds': 100, 'visibility': 10000, 'wind_speed': 4.39, 'wind_deg': 263, 'wind_gust': 4.46, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.1}, {'dt': 1629014400, 'temp': 306.26, 'feels_like': 308.55, 'pressure': 1003, 'humidity': 46, 'dew_point': 292.98, 'uvi': 8.75, 'clouds': 99, 'visibility': 10000, 'wind_speed': 4.07, 'wind_deg': 269, 'wind_gust': 4.16, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.12}, {'dt': 1629018000, 'temp': 306.57, 'feels_like': 308.59, 'pressure': 1002, 'humidity': 44, 'dew_point': 292.49, 'uvi': 6.72, 'clouds': 85, 'visibility': 10000, 'wind_speed': 4.11, 'wind_deg': 269, 'wind_gust': 4.46, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.12}, {'dt': 1629021600, 'temp': 305.69, 'feels_like': 308.02, 'pressure': 1002, 'humidity': 48, 'dew_point': 292.99, 'uvi': 1.32, 'clouds': 81, 'visibility': 10000, 'wind_speed': 5.57, 'wind_deg': 271, 'wind_gust': 5.28, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0.1}, {'dt': 1629025200, 'temp': 303.39, 'feels_like': 305.64, 'pressure': 1003, 'humidity': 56, 'dew_point': 293.61, 'uvi': 0.62, 'clouds': 84, 'visibility': 10000, 'wind_speed': 5.29, 'wind_deg': 278, 'wind_gust': 6.95, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04d'}], 'pop': 0.16}, {'dt': 1629028800, 'temp': 303.2, 'feels_like': 305.88, 'pressure': 1003, 'humidity': 59, 'dew_point': 294.07, 'uvi': 0.19, 'clouds': 86, 'visibility': 10000, 'wind_speed': 4.07, 'wind_deg': 269, 'wind_gust': 6.56, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.16}, {'dt': 1629032400, 'temp': 302.46, 'feels_like': 305.06, 'pressure': 1003, 'humidity': 62, 'dew_point': 294.14, 'uvi': 0, 'clouds': 94, 'visibility': 10000, 'wind_speed': 3.53, 'wind_deg': 261, 'wind_gust': 6.64, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04d'}], 'pop': 0.16}, {'dt': 1629036000, 'temp': 301.81, 'feels_like': 304.05, 'pressure': 1004, 'humidity': 63, 'dew_point': 293.89, 'uvi': 0, 'clouds': 88, 'visibility': 10000, 'wind_speed': 3.5, 'wind_deg': 273, 'wind_gust': 7.58, 'weather': [{'id': 804, 'main': 'Clouds', 'description': 'overcast clouds', 'icon': '04n'}], 'pop': 0.16}, {'dt': 1629039600, 'temp': 301.12, 'feels_like': 303.25, 'pressure': 1005, 'humidity': 66, 'dew_point': 293.94, 'uvi': 0, 'clouds': 84, 'visibility': 10000, 'wind_speed': 3.29, 'wind_deg': 290, 'wind_gust': 7.5, 'weather': [{'id': 803, 'main': 'Clouds', 'description': 'broken clouds', 'icon': '04n'}], 'pop': 0.11}]
        # print(weather_data[:12])
        return weather_data[:12]

    def grab_codes(self):
        weather_json = self.get_response()
        codes = [hour["weather"][0]["id"] for hour in weather_json]
        return codes
